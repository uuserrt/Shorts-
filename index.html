<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Auto Shorts Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
  padding: 20px;
}
.box {
  background: #222;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 8px;
}
input, button, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  border-radius: 6px;
  border: none;
}
button {
  background: #00aaff;
  font-weight: bold;
  color: #000;
  cursor: pointer;
}
button:hover {
  background: #0088cc;
}
#log {
  background: #000;
  padding: 15px;
  border-radius: 8px;
  height: 200px;
  overflow-y: auto;
  white-space: pre-line;
  border: 1px solid #333;
}
video {
  width: 100%;
  margin-top: 10px;
  border-radius: 8px;
}
</style>
</head>

<body>

<h2>ðŸ”¥ AUTO SHORTS MAKER (AI + STOCK + TTS + SUBTITLES)</h2>

<div class="box">
  <label>Enter Topic:</label>
  <input id="topic" placeholder="Example: Discipline, Focus, Success...">
  <button onclick="generateShort()">ðŸŽ¬ Generate Short</button>
</div>

<h3>ðŸ“¢ Logs:</h3>
<div id="log">Waiting...</div>

<h3>ðŸŽ¥ Video Preview:</h3>
<video id="preview" controls></video>

<a id="download" style="color:#00eaff;font-size:18px;" download>â¬‡ Download Video</a>

<script>
function log(msg){
  document.getElementById('log').innerText += "\n" + msg;
}

async function generateShort(){
  document.getElementById('log').innerText = "Starting...\n";
  const topic = document.getElementById('topic').value.trim();
  if(!topic){ log("âŒ Topic required"); return; }

  log("âœ Generating script...");
  const script = `Discipline makes you unstoppable.
à¤…à¤¬ à¤®à¥‡à¤¹à¤¨à¤¤ à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‹à¥¤
${topic} creates success.`

  log("ðŸ“œ Script ready:\n" + script);

  log("ðŸŽ¤ Generating Audio...");
  const ttsRes = await fetch("/api/fish", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ text: script })
  });

  const ttsJSON = await ttsRes.json();
  if(!ttsJSON.audio){ log("âŒ Audio generation failed"); return; }

  log("ðŸ“¦ Audio created");

  log("ðŸŽ¥ Fetching Stock Clips...");
  const pexelsRes = await fetch("/api/pexels?query=" + topic);
  const pexelsJSON = await pexelsRes.json();

  if(!pexelsJSON.videos){ log("âŒ No clips found"); return; }

  log("ðŸŽ¬ Clips found: " + pexelsJSON.videos.length);

  log("ðŸ›  Submitting Final Render...");
  const renderRes = await fetch("/api/render", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      script: script,
      audio: ttsJSON.audio,
      clips: pexelsJSON.videos
    })
  });

  const renderJSON = await renderRes.json();
  if(!renderJSON.job){ log("âŒ Render submit failed"); return; }

  log("ðŸ“¡ Render Started: " + renderJSON.job);

  let final = null;

  while(true){
    const jobRes = await fetch("/api/job?id=" + renderJSON.job);
    const jobJSON = await jobRes.json();

    log("â³ Status: " + jobJSON.status);

    if(jobJSON.status === "done"){
      final = jobJSON.url;
      break;
    }
    if(jobJSON.status === "error"){
      log("âŒ Render Error");
      return;
    }
    await new Promise(r => setTimeout(r, 3000));
  }

  log("âœ… Render Finished");

  const video = document.getElementById("preview");
  video.src = final;

  const dl = document.getElementById("download");
  dl.href = final;
  dl.innerText = "â¬‡ Download Ready Video";

  log("ðŸŽ‰ Video Ready");
}
</script>

</body>
</html>
